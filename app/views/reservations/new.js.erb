// TODO: Full commenting
//       Move whatever can move to main js file


// Hide ajax-loader
$("#ajax-modal #remote_progress").remove();
$("#ajax-modal").find(".modal-body .ajax-loader").hide()
// Load edit into HTML
$("#ajax-modal").find(".modal-body .modal-body-content").html('<%=j render :partial => "new" %>')
// Show modal-content-body
$("#ajax-modal").addClass("fullscreen");
$("#ajax-modal").find(".modal-body .modal-body-content").show()
// Find headers and repopulate modal-title
$("#ajax-modal").find(".modal-title").html($("#ajax-modal").find(".modal-body .modal-body-content").find("h1"))
// Move submit action to modal-footer and set to remotely submit form
if (!$("#ajax-modal").find(".modal-footer button[type='submit']").is("*")) {
  $("#ajax-modal").find(".modal-footer").append($("#ajax-modal .ajax_form").find("button[type='submit']").addClass("btn-large btn-primary").on("click", function() {
    $("#ajax-modal").find(".modal-footer #reservation_cc").clone().appendTo(".ajax_form");
    $("#ajax-modal").find(".modal-footer #reservation_title").clone().appendTo(".ajax_form");
    $("#ajax-modal").find(".ajax_form").submit();
    $('#ajax-modal').find("#top_of_page").focus();
  }));
}
// Move extra fields in availability grid to modal-footer, just pretties it up a bit
$("#ajax-modal").find(".ajax_form table tbody tr:last").hide();
$("#ajax-modal").find(".ajax_form .extra_fields").closest("tr").hide();
if (!$("#ajax-modal").find(".modal-footer .extra_fields").is("*")) {
  $("#ajax-modal").find(".modal-footer").prepend($("#ajax-modal .ajax_form").find(".extra_fields div"));
  $("#ajax-modal").find(".modal-footer div").wrapAll($("<div />").addClass("extra_fields"));
  $("#ajax-modal").find(".modal-footer").find("#res_title_label_div, #res_title_div").wrapAll($("<div />").addClass("extra_field"));
  $("#ajax-modal").find(".modal-footer").find("#res_cc_label_div, #res_cc_div").wrapAll($("<div />").addClass("extra_field"));
}
$("#ajax-modal").find(".modal-footer .extra_fields").hide();
// when a room is selected, show the extra fields with animation and highlight
$('#ajax-modal').find('.ajax_form input[name="reservation[room_id]"]').on("change" ,function(event) {
	if ($('#ajax-modal').find(".ajax_form input[name='reservation[room_id]']").is(':checked') && $("#ajax-modal").find(".modal-footer .extra_fields").is(':hidden')) {
		$('#ajax-modal').find(".modal-footer .extra_fields").show();
		$("#ajax-modal").find(".modal-body").animate({
		    height: '-=' + $("#ajax-modal").find(".modal-footer .extra_fields").height()
		}, 200, function() {	
				$('#ajax-modal').find(".modal-footer input#reservation_title").focus();
				$('#ajax-modal').find(".modal-footer input#reservation_title").effect("highlight", {}, 3000);
		});
	}
});
$("#ajax-modal").find("a[data-remote='true'], .modal-footer button[type='submit']").on("click", function() {
  if (!$("#ajax-modal #remote_progress").is("*")) {
    $("#ajax-modal").find(".modal-header").append($("<div />").attr({'id': 'remote_progress'}).addClass("progress progress-striped active").append($("<div />").addClass("bar").css({width: '5%'})));
    setTimeout(function() { 
      $("#remote_progress > div.bar").css({width: "98%"})
    }, 0);
  }
});
if (!$("#ajax-modal").find(".modal-header .legend").is("*")) {
  $("#ajax-modal").find(".modal-header").append($("#ajax-modal").find(".modal-body .legend:first"));
}
if (!$("#ajax-modal").find(".modal-header p").is("*")) {
  $("#ajax-modal").find(".modal-header").append($("#ajax-modal").find(".modal-body .availability_grid_desc"));
}
$("#ajax-modal").find(".modal-body .legend").hide();
$("#ajax-modal").find(".modal-body .availability_grid_desc").hide();
if ($('#ajax-modal').find(".ajax_form input[name='reservation[room_id]']").is(':checked') && $("#ajax-modal").find(".modal-footer .extra_fields").is(':hidden')) {
	$('#ajax-modal').find(".modal-footer .extra_fields").show();
}
$("#ajax-modal").find("a[data-remote='true'], .modal-footer button[type='submit']").on('click', function() {
  $('#ajax-modal').find(".modal-footer .extra_fields").hide();
  $("#ajax-modal").find(".modal-body").animate({
	    height: '+=' + $("#ajax-modal").find(".modal-footer .extra_fields").height()
	}, 200);
});

